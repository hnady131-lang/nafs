<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุงูุณ - ุทููุญ ูุทู ูุชููุฒ ุฌูู</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
    * { font-family: 'Tajawal', sans-serif; }
    html, body { height: 100%; }
    .slide-in { animation: slideIn 0.5s ease-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    .option-hover:hover { background-color: #fdf2f8; border-color: #ec4899; transform: scale(1.01); }
    .ranking-item { display: flex; align-items: center; padding: 12px; background: white; border-radius: 12px; border-right: 5px solid #a78bfa; margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
  </style>
 </head>
 <body class="bg-gradient-to-b from-indigo-100 via-purple-50 to-pink-100 h-full m-0 p-0 text-right">
  
  <div id="app" class="w-full h-full overflow-auto">
    <div id="mainContent" class="min-h-full flex flex-col">
      <header class="bg-gradient-to-l from-emerald-500 to-teal-600 text-white shadow-xl p-4 sticky top-0 z-50">
        <div class="max-w-2xl mx-auto">
          <div class="bg-white/20 rounded-xl p-3 backdrop-blur-md mb-3 text-center slide-in">
            <p class="text-sm font-bold leading-relaxed">๐ฏ "ูุฏููุง ุฃู ูุญุตู ูู ุทูู ุณุนูุฏู ุนูู ูุฑุต ุงูุชุนูู ุงูุฌูุฏ"<br>
            <span class="text-xs opacity-90">ุจุฑูุงูุฌ ุชูููุฉ ุงููุฏุฑุงุช ุงูุจุดุฑูุฉ - ูุงูุณ</span></p>
          </div>
          <h1 class="text-2xl font-black text-center mb-2">ูุงูุณ - ุงูููุงุฑุงุช ุงูุฑูุงุถูุฉ</h1>
          <p class="text-center text-sm font-bold bg-black/10 rounded-full py-1">ุงููุนููุฉ: <span class="text-yellow-300">ููุงุฏู ุฎูู ุงูุณููู</span></p>
          
          <div class="grid grid-cols-3 gap-2 mt-4">
            <div class="bg-white/10 rounded-lg p-2 text-center text-[10px]">ุงูุฒูุงุฑุงุช<p id="visitCount" class="text-xl font-black">0</p></div>
            <div class="bg-white/10 rounded-lg p-2 text-center text-[10px]">ุงูุฃุนูู ููุงุทุงู<p id="lastVisitor" class="text-[10px] font-bold truncate">-</p></div>
            <div id="starsBox" class="bg-white/10 rounded-lg p-2 text-center text-[10px] cursor-pointer active:bg-white/20">ุฅุฌูุงูู ุงููุฌูู<p id="totalStars" class="text-xl font-black">0</p></div>
          </div>
        </div>
      </header>

      <main class="flex-1 p-4">
        <div class="max-w-2xl mx-auto">
          
          <section id="homeScreen" class="slide-in">
            <div id="loginBox" class="bg-white rounded-3xl shadow-xl p-6 border-b-8 border-purple-400 mb-6">
              <h2 class="text-2xl font-black text-purple-800 text-center mb-4">๐ฎ ุงุณุชุนุฏ ููุชุญุฏู!</h2>
              <input id="studentNameInput" type="text" placeholder="ุฃุฏุฎู ุงุณูู ุงูุซูุงุซู..." class="w-full px-4 py-4 rounded-2xl border-2 border-purple-100 focus:border-purple-500 outline-none text-lg font-bold text-center mb-4">
              <button id="btnStartQuiz" class="w-full bg-purple-600 text-white py-4 rounded-2xl font-black text-xl shadow-lg active:scale-95 transition-transform">ุงูุทูู ุงูุขู! ๐</button>
            </div>

            <div id="quizSelection" class="hidden space-y-4">
              <h3 class="text-center font-black text-purple-900 text-lg py-2">ุงุฎุชุฑ ูุฌุงู ุงูุชุญุฏู:</h3>
              <div class="grid grid-cols-1 gap-4 pb-10">
                <div class="bg-emerald-50 p-4 rounded-2xl border-2 border-emerald-200">
                  <h4 class="font-black text-emerald-700 mb-3 flex items-center">๐ข ุงูุฃุนุฏุงุฏ ูุงูุนูููุงุช</h4>
                  <div class="flex gap-2">
                    <button class="quizBtn flex-1 bg-emerald-500 text-white py-2 rounded-xl text-xs font-bold" data-domain="numbers" data-level="ูุจุชุฏุฆ">ุชุฃุณูุณ</button>
                    <button class="quizBtn flex-1 bg-emerald-600 text-white py-2 rounded-xl text-xs font-bold" data-domain="numbers" data-level="ูุชูุณุท">ุชูููู</button>
                    <button class="quizBtn flex-1 bg-emerald-700 text-white py-2 rounded-xl text-xs font-bold" data-domain="numbers" data-level="ูุชูุฏู">ุชุญููู</button>
                  </div>
                </div>
                <div class="bg-blue-50 p-4 rounded-2xl border-2 border-blue-200">
                  <h4 class="font-black text-blue-700 mb-3 flex items-center">๐ ุงูุฌุจุฑ ูุงูุฃููุงุท</h4>
                  <div class="flex gap-2">
                    <button class="quizBtn flex-1 bg-blue-500 text-white py-2 rounded-xl text-xs font-bold" data-domain="algebra" data-level="ูุจุชุฏุฆ">ุชุฃุณูุณ</button>
                    <button class="quizBtn flex-1 bg-blue-600 text-white py-2 rounded-xl text-xs font-bold" data-domain="algebra" data-level="ูุชูุณุท">ุชูููู</button>
                    <button class="quizBtn flex-1 bg-blue-700 text-white py-2 rounded-xl text-xs font-bold" data-domain="algebra" data-level="ูุชูุฏู">ุชุญููู</button>
                  </div>
                </div>
                <div class="bg-orange-50 p-4 rounded-2xl border-2 border-orange-200">
                  <h4 class="font-black text-orange-700 mb-3 flex items-center">๐ ุงูููุฏุณุฉ ูุงูููุงุณ</h4>
                  <div class="flex gap-2">
                    <button class="quizBtn flex-1 bg-orange-500 text-white py-2 rounded-xl text-xs font-bold" data-domain="geometry" data-level="ูุจุชุฏุฆ">ุชุฃุณูุณ</button>
                    <button class="quizBtn flex-1 bg-orange-600 text-white py-2 rounded-xl text-xs font-bold" data-domain="geometry" data-level="ูุชูุณุท">ุชูููู</button>
                    <button class="quizBtn flex-1 bg-orange-700 text-white py-2 rounded-xl text-xs font-bold" data-domain="geometry" data-level="ูุชูุฏู">ุชุญููู</button>
                  </div>
                </div>
                <div class="bg-purple-50 p-4 rounded-2xl border-2 border-purple-200">
                  <h4 class="font-black text-purple-700 mb-3 flex items-center">๐ ุงูุฅุญุตุงุก ูุงูุงุญุชูุงูุงุช</h4>
                  <div class="flex gap-2">
                    <button class="quizBtn flex-1 bg-purple-500 text-white py-2 rounded-xl text-xs font-bold" data-domain="stats" data-level="ูุจุชุฏุฆ">ุชุฃุณูุณ</button>
                    <button class="quizBtn flex-1 bg-purple-600 text-white py-2 rounded-xl text-xs font-bold" data-domain="stats" data-level="ูุชูุณุท">ุชูููู</button>
                    <button class="quizBtn flex-1 bg-purple-700 text-white py-2 rounded-xl text-xs font-bold" data-domain="stats" data-level="ูุชูุฏู">ุชุญููู</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-8 bg-white/60 backdrop-blur-sm rounded-3xl p-6 border-2 border-purple-200">
              <h3 class="text-xl font-black text-center text-purple-900 mb-4 text-sm uppercase tracking-widest">๐ ุฃุจุทุงู ูุงูุณ</h3>
              <div id="allStudentsRanking" class="space-y-2"></div>
              <button id="adminResetBtn" onclick="clearSystemData()" class="hidden w-full mt-4 text-[10px] text-red-500 underline py-2 bg-red-50 rounded-lg">ุฅุนุงุฏุฉ ุถุจุท ุงูุจูุงูุงุช (ูููุนููุฉ)</button>
            </div>
          </section>

          <section id="quizScreen" class="hidden slide-in pb-10">
            <div class="flex items-center justify-between mb-4 bg-white p-4 rounded-2xl shadow-sm border border-emerald-100">
              <h2 id="quizTitle" class="font-black text-emerald-800 text-sm"></h2>
              <button onclick="location.reload()" class="text-xs font-bold text-red-500 bg-red-50 px-3 py-1 rounded-full">ุงูุณุญุงุจ</button>
            </div>
            <div id="questionsContainer" class="space-y-6"></div>
            <button id="btnSubmitQuiz" class="w-full mt-8 bg-emerald-600 text-white py-4 rounded-2xl font-black text-xl shadow-lg hover:bg-emerald-700">ุฅุฑุณุงู ุงูุฅุฌุงุจุงุช โ</button>
          </section>

          <section id="resultsScreen" class="hidden slide-in text-center">
            <div class="bg-white rounded-3xl shadow-2xl p-8 border-t-8 border-yellow-400">
              <div class="text-7xl mb-4">๐</div>
              <h2 class="text-2xl font-black text-purple-900 mb-2">ููู ูุง ุจุทู/ุฉ!</h2>
              <p id="resultName" class="text-lg font-bold text-purple-600 mb-6"></p>
              <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-purple-50 p-4 rounded-2xl border border-purple-100">
                  <p class="text-[10px] text-gray-500 font-bold mb-1">ุงูุฏุฑุฌุฉ</p>
                  <p id="scoreDisplay" class="text-2xl font-black text-purple-700"></p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-2xl border border-yellow-100">
                  <p class="text-[10px] text-gray-500 font-bold mb-1">ุงููุฌูู ุงูููุชุณุจุฉ</p>
                  <div id="starsDisplay" class="text-xl"></div>
                </div>
              </div>
              <button id="btnBackHome" class="w-full bg-emerald-600 text-white py-4 rounded-2xl font-bold shadow-md mb-3">๐ ููุญุฉ ุงูุตุฏุงุฑุฉ</button>
              <button id="btnTakeAnother" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-md">๐ ููุงุฑุฉ ุฃุฎุฑู</button>
            </div>
          </section>
        </div>
      </main>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCnKMPDckU-XmZpblUkV55Im6tYa_VAxT0",
      authDomain: "nafisproject-48aa3.firebaseapp.com",
      databaseURL: "https://nafisproject-48aa3-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "nafisproject-48aa3",
      storageBucket: "nafisproject-48aa3.firebasestorage.app",
      messagingSenderId: "12586578618",
      appId: "1:12586578618:web:376568ddf058b278b94883",
      measurementId: "G-BSN3X12HB1"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

const questions = {
      numbers: { // ุงูุฃุนุฏุงุฏ ูุงูุนูููุงุช (15 ุณุคุงู)
        ูุจุชุฏุฆ: [
          { q: "ูู ุฑุญูุฉ ูุฏุฑุณูุฉุ ุฑูุจ ูคูฃ ุทุงูุจุงู ูู ุงูุญุงููุฉ ุงูุฃููู ู ูฃู ุทุงูุจุงู ูู ุงูุซุงููุฉ. ูุง 'ุชูุฏูุฑ' ูุฌููุนูู ูุฃูุฑุจ ุนุดุฑุฉุ", options: ["ูงู", "ูจู", "ูฆู", "ูฉู"], correct: 0 },
          { q: "ูุชุจุช ุฑูู ุนุฏุฏุงู ูุญุชูู ุนูู ูค ูู ุงูุนุดุฑุงุชุ ูข ูู ุงููุฆุงุชุ ู ูฅ ูู ุงูุขุญุงุฏ. ูุง ูู ุงูุนุฏุฏุ", options: ["ูคูขูฅ", "ูขูคูฅ", "ูฅูคูข", "ูขูฅูค"], correct: 1 },
          { q: "ุฃู ุงูุฃุนุฏุงุฏ ุงูุชุงููุฉ ููุซู ุงูุตูุบุฉ ุงูุชุญููููุฉ ( ูฆ + ูจู + ูฅูู )ุ", options: ["ูฆูจูฅ", "ูฅูจูฆ", "ูจูฅูฆ", "ูฅูฆูจ"], correct: 1 },
          { q: "ูุงุฑู ุจูู ุงูุนุฏุฏูู: ูงูจูฉ (...) ูงูฉูจ", options: [">", "<", "=", "ุบูุฑ ุฐูู"], correct: 1 },
          { q: "ูุง ุงููููุฉ ุงูููุฒููุฉ ููุฑูู ูฉ ูู ุงูุนุฏุฏ ูฉูคูขุ", options: ["ูฉ", "ูฉู", "ูฉูู", "ูฉููู"], correct: 2 }
        ],
        ูุชูุณุท: [
          { q: "ุงุดุชุฑุช ุงููุฏุฑุณุฉ ูฅ ุตูุงุฏูู ุฃููุงูุ ูู ูู ุตูุฏูู ูกู ุฃููุงู. ูุฒุนุช ุงููุนููุฉ ูขูฅ ูููุงูุ ูู ุจููุ", options: ["ูกูฅ", "ูขูฅ", "ูฃูฅ", "ูฅู"], correct: 1 },
          { q: "ูุน ุฎุงูุฏ ูงูฅ ุฑูุงูุงูุ ุงุดุชุฑู ูุตุฉ ุจู ูกูฅ ุฑูุงูุงู ูุนูุจุฉ ุฃููุงู ุจู ูขู ุฑูุงูุงู. ูู ุฑูุงูุงู ุจูู ูุนูุ", options: ["ูฃูฅ", "ูคู", "ูคูฅ", "ูฅู"], correct: 1 },
          { q: "ุฃู ูู ุงูุฃุนุฏุงุฏ ุงูุชุงููุฉ ูู ุนุฏุฏ 'ุฒูุฌู'ุ", options: ["ูกูฃ", "ูขูฅ", "ูคูจ", "ูฃูง"], correct: 2 },
          { q: "ูุงุชุฌ ุฌูุน ูฃูคูข + ูกูขูฅ ูู:", options: ["ูคูฆูง", "ูคูฅูง", "ูคูงูฆ", "ูฃูฆูง"], correct: 0 },
          { q: "ูุฏู ุฃุญูุฏ ูฃ ูุฌููุนุงุช ูู ุงูุทูุงุจุนุ ูู ูู ูุฌููุนุฉ ูฉ ุทูุงุจุน. ูุง ูุฌููุน ุทูุงุจุนูุ", options: ["ูกูข", "ูขูค", "ูขูง", "ูฃู"], correct: 2 }
        ],
        ูุชูุฏู: [
          { q: "ูุฒุน ุฃุจ ูคูจ ุฑูุงูุงู ุนูู ุฃุจูุงุฆู ุงูุณุชุฉ ุจุงูุชุณุงูู. ุฃู ุญูููุฉ ุถุฑุจ ุชุณุงุนุฏู ุนูู ุงูุญูุ", options: ["ูฆรูง=ูคูข", "ูฆรูจ=ูคูจ", "ูฆรูฆ=ูฃูฆ", "ูฆรูฉ=ูฅูค"], correct: 1 },
          { q: "ูุทุงุฑ ููู ูจ ุนุฑุจุงุชุ ูู ูู ุนุฑุจุฉ ูกู ุฑูุงุจ. ูู ุงููุญุทุฉ ุงูุฃููู ูุฒู ูกูฅ ุฑุงูุจุงู. ูู ุฑุงูุจุงู ุจููุ", options: ["ูงูฅ", "ูฆูฅ", "ูฅูฅ", "ูจู"], correct: 1 },
          { q: "ูุง ูุงุชุฌ ูุณูุฉ ูคู รท ูฅุ", options: ["ูฆ", "ูง", "ูจ", "ูฉ"], correct: 2 },
          { q: "ุฅุฐุง ูุงู ูุงุชุฌ ุถุฑุจ ูค ร ูฉ = ูฃูฆุ ููุง ูุงุชุฌ ูคู ร ูฉุ", options: ["ูฃูฆู", "ูฃูฆูู", "ูฃูฆ", "ูคูู"], correct: 0 },
          { q: "ุฑุชุจ ุงูุฃุนุฏุงุฏ ุชุฒุงูุฏูุงู: ูฃูคูฅ ุ ูขูกู ุ ูฅูู", options: ["ูฅููุูฃูคูฅุูขูกู", "ูขูกูุูฃูคูฅุูฅูู", "ูฃูคูฅุูขูกูุูฅูู", "ูขูกูุูฅููุูฃูคูฅ"], correct: 1 }
        ]
      },
      algebra: { // ุงูุฌุจุฑ ูุงูุฃููุงุท (15 ุณุคุงู)
        ูุจุชุฏุฆ: [
          { q: "ูุง ุงูุนุฏุฏ ุงูุชุงูู ูู ุงูููุท: ูกูุ ูกูฅุ ูขูุ ูขูฅุ ุ", options: ["ูขูฆ", "ูฃู", "ูฃูฅ", "ูคู"], correct: 1 },
          { q: "ูู ุงูููุท ( ูขุ ูคุ ูฆุ ูจ ) ุงููุงุนุฏุฉ ูู:", options: ["ุฅุถุงูุฉ ูก", "ุฅุถุงูุฉ ูข", "ุทุฑุญ ูข", "ุฅุถุงูุฉ ูฃ"], correct: 1 },
          { q: "ุฃููู ุงูุฌููุฉ: ูฅ + ูจ = ูจ + ...", options: ["ูฅ", "ูจ", "ูกูฃ", "ู"], correct: 0 },
          { q: "ุงูุนุฏุฏ ุงูููููุฏ ูู ุงูููุท ( ูฅูุ ูฆูุ ...ุ ูจู ) ูู:", options: ["ูฆูฅ", "ูงู", "ูงูฅ", "ูฉู"], correct: 1 },
          { q: "ุฅุฐุง ูุงูุช ูง + ูฃ = ูกูุ ูุฅู ูกู - ูฃ = ...", options: ["ูฃ", "ูง", "ูกู", "ูฅ"], correct: 1 }
        ],
        ูุชูุณุท: [
          { q: "ุฃู ุงูุฌูู ุงูุชุงููุฉ ุชูุถุญ ุฎุงุตูุฉ 'ุงูุฅุจุฏุงู' ูู ุงูุฌูุนุ", options: ["ูฅ+ู=ูฅ", "ูฅ+ูฃ=ูฃ+ูฅ", "ูฅ+ูก=ูฆ", "ูข+ูข+ูข=ูฆ"], correct: 1 },
          { q: "ุฅุฐุง ูุงู ( โก + ูฆ = ูกู )ุ ููุง ูููุฉ โกุ", options: ["ูฃ", "ูค", "ูฅ", "ูฆ"], correct: 1 },
          { q: "ูุง ุงูุนุฏุฏ ุงูุฐู ูุฌุนู ุงูุฌููุฉ ุตุญูุญุฉ: ูฉ - ... = ูคุ", options: ["ูฃ", "ูค", "ูฅ", "ูฆ"], correct: 2 },
          { q: "ุชููู ูุจุชุฉ ูข ุณู ูู ููู. ุฅุฐุง ูุงู ุทูููุง ุงูููู ูกู ุณูุ ููู ุทูููุง ุจุนุฏ ูฃ ุฃูุงูุ", options: ["ูกูข", "ูกูค", "ูกูฆ", "ูกูจ"], correct: 2 },
          { q: "ุฃููู ุงูููุท: ูจูุ ูงูุ ูฆูุ ...", options: ["ูฅู", "ูคู", "ูฅูฅ", "ูฆูฅ"], correct: 0 }
        ],
        ูุชูุฏู: [
          { q: "ูู ุงูููุท ( ูฅูุ ูคูฆุ ูคูขุ ูฃูจ )ุ ูุง ูู ุงููุงุนุฏุฉ ุงููุชุจุนุฉุ", options: ["ุฒูุงุฏุฉ ูค", "ุทุฑุญ ูค", "ุทุฑุญ ูข", "ุทุฑุญ ูฆ"], correct: 1 },
          { q: "ุฅุฐุง ูุงู ( ูฃ ร โก = ูกูข ) ู ( โก + ูฅ = ูฉ )ุ ูุฅู โก ูู:", options: ["ูฃ", "ูค", "ูฅ", "ูฆ"], correct: 1 },
          { q: "ูุง ุงููุงุนุฏุฉ ูู ูุฐุง ุงูุฌุฏูู (ุงููุฏุฎูุฉ ูค ุตุงุฑุช ูจ)ุ (ุงููุฏุฎูุฉ ูฅ ุตุงุฑุช ูกู)ุ", options: ["ุฅุถุงูุฉ ูค", "ุถุฑุจ ูข", "ุทุฑุญ ูข", "ูุณูุฉ ูข"], correct: 1 },
          { q: "ุงูุนุฏ ุงูููุฒู ( ูฃุ ูฆุ ูฉุ ูกูข ) ููุซู ุฌุฏูู ุถุฑุจ ุงูุนุฏุฏ:", options: ["ูข", "ูฃ", "ูค", "ูฅ"], correct: 1 },
          { q: "ุฃู ุฌููุฉ ุนุฏุฏูุฉ ุชูุซู (ูุฏู ุฃุญูุฏ ูฅ ุณูุงุฑุงุช ูุฃุนุทุงู ูุงูุฏู ูฃ ุณูุงุฑุงุช ูุฃุตุจุญ ูุฏูู ูจ)ุ", options: ["ูฅ-ูฃ=ูข", "ูฅ+ูฃ=ูจ", "ูจ-ูฅ=ูฃ", "ูฃ+ูฅ=ูจ"], correct: 1 }
        ]
      },
      geometry: { // ุงูููุฏุณุฉ ูุงูููุงุณ (15 ุณุคุงู)
        ูุจุชุฏุฆ: [
          { q: "ุฑุณูุช ููุฑุฉ ุดููุงู ูู ูค ุฃุถูุงุน ูุชุทุงุจูุฉ ู ูค ุฒูุงูุง ูุงุฆูุฉ. ูุง ููุ", options: ["ุงููุซูุซ", "ุงููุฑุจุน", "ุงูุฏุงุฆุฑุฉ", "ุงููุฎุฑูุท"], correct: 1 },
          { q: "ูู ูุฌูุงู ููููุนุจุ", options: ["ูค", "ูฅ", "ูฆ", "ูจ"], correct: 2 },
          { q: "ุงูุดูู ุงูุฐู ููุณ ูู ุฃุถูุงุน ููุง ุฑุคูุณ ูู:", options: ["ุงููุฑุจุน", "ุงููุณุชุทูู", "ุงูุฏุงุฆุฑุฉ", "ุงููุซูุซ"], correct: 2 },
          { q: "ูุญุฏุฉ ุงูููุงุณ ุงูููุงุณุจุฉ ูููุงุณ ุทูู ููู ุงูุฑุตุงุต ูู:", options: ["ุงููุชุฑ", "ุงูุณูุชููุชุฑ", "ุงููููููุชุฑ", "ุงููุชุฑ"], correct: 1 },
          { q: "ูู ุฑุฃุณุงู ูููุซูุซุ", options: ["ูข", "ูฃ", "ูค", "ู"], correct: 1 }
        ],
        ูุชูุณุท: [
          { q: "ูุฑูุฏ ููุฏ ุจูุงุก ุณูุฑ ุญูู ุญุฏููุฉ ูุฑุจุนุฉ ุทูู ุถูุนูุง ูฆ ุฃูุชุงุฑ. ูู ุทูู ุงูุณูุฑ ุจุงููุงููุ", options: ["ูกูขู", "ูกูจู", "ูขูคู", "ูฃูฆู"], correct: 2 },
          { q: "ุงูุณุงุนุฉ ุชุดูุฑ ุฅูู ุงูุซุงูุซุฉ ุชูุงูุงู. ูู ูููู ุงูููุช ุจุนุฏ ูุฑูุฑ ูฃู ุฏูููุฉุ", options: ["ูฃ:ูกูฅ", "ูฃ:ูฃู", "ูค:ูู", "ูฃ:ูคูฅ"], correct: 1 },
          { q: "ุฃู ุงููุฌุณูุงุช ุงูุชุงููุฉ ูุดุจู ุนูุจุฉ ุงูุฏูุงูุ", options: ["ุงููุฑุฉ", "ุงููุฎุฑูุท", "ุงูุฃุณุทูุงูุฉ", "ุงูููุนุจ"], correct: 2 },
          { q: "ุงููุณุชุทูู ูู ุฃุฑุจุนุฉ ุฃุถูุงุนุ ูู ุถูุนูู ูุชูุงุจููู ููู:", options: ["ูุฎุชููุงู", "ูุชุทุงุจูุงู", "ููุญููุงู", "ูุง ุดูุก"], correct: 1 },
          { q: "ูุญุฏุฉ ุงูููุงุณ ุงูููุงุณุจุฉ ูุณุนุฉ ุนูุจุฉ ุนุตูุฑ ุตุบูุฑุฉ ูู:", options: ["ุงููุชุฑ", "ุงูููููุชุฑ", "ุงููุชุฑ", "ุงูุฌุฑุงู"], correct: 1 }
        ],
        ูุชูุฏู: [
          { q: "ุฃู ุงููุฌุณูุงุช ุงูุชุงููุฉ ูู ูุฌู ูุงุญุฏ ุฏุงุฆุฑู ูุฑุฃุณ ูุงุญุฏุ", options: ["ุงููุฑุฉ", "ุงููุฎุฑูุท", "ุงูุฃุณุทูุงูุฉ", "ุงููุฑู"], correct: 1 },
          { q: "ุฅุฐุง ูุงู ุทูู ุฏูุชุฑ ูขู ุณูุ ููู ูููู ุทูู ุฏูุชุฑูู ูุถุนููุง ูุญูุฏ ุจุฌุงูุจ ุจุนุถููุงุ", options: ["ูขู ุณู", "ูฃู ุณู", "ูคู ุณู", "ูฅู ุณู"], correct: 2 },
          { q: "ุจุฏุฃุช ุงูุญุตุฉ ุงูุณุงุนุฉ ูจ:ูู ูุงูุชูุช ูจ:ูคูฅ. ูู ูุฏุฉ ุงูุญุตุฉุ", options: ["ูฃู ุฏูููุฉ", "ูคูฅ ุฏูููุฉ", "ูฆู ุฏูููุฉ", "ูกูฅ ุฏูููุฉ"], correct: 1 },
          { q: "ูุญูุท ูุซูุซ ุฃุทูุงู ุฃุถูุงุนู ูฃ ุณูุ ูค ุณูุ ูฅ ุณู ูู:", options: ["ูง ุณู", "ูฉ ุณู", "ูกูข ุณู", "ูกูฅ ุณู"], correct: 2 },
          { q: "ูู ุดูุฑุงู ูู ุงูุณูุฉ ุงููููุงุฏูุฉุ", options: ["ูกู", "ูกูก", "ูกูข", "ูกูฃ"], correct: 2 }
        ]
      },
      stats: { // ุงูุฅุญุตุงุก ูุงูุงุญุชูุงูุงุช (15 ุณุคุงู)
        ูุจุชุฏุฆ: [
          { q: "ูู ููุณ ูง ูุฑุงุช ุจูุถุงุก ููุท. ุณุญุจูุง ูุฑุฉุ ูุง ุงุญุชูุงู ุฃู ุชููู ุณูุฏุงุกุ", options: ["ุฃููุฏ", "ูููู", "ูุณุชุญูู", "ุฃูู ุงุญุชูุงูุงู"], correct: 2 },
          { q: "ุนูุฏ ุฑูู ููุนุจ ุฃุฑูุงู (ูก-ูฆ)ุ ูุง ุงุญุชูุงู ุธููุฑ ุงูุฑูู ูงุ", options: ["ุฃููุฏ", "ูููู", "ูุณุชุญูู", "ุถุนูู"], correct: 2 },
          { q: "ูู ุชูุซูู ุจุงูุตูุฑุ ุฅุฐุง ูุงูุช ูู ุตูุฑุฉ (โญ) ุชูุซู ุทููููุ ููุง ุนุฏุฏ ุงูุฃุทูุงู ุนูุฏ ูุฌูุฏ ูฃ ูุฌููุ", options: ["ูฃ", "ูค", "ูฅ", "ูฆ"], correct: 3 },
          { q: "ุฃู ุงููููุงุช ุชุตู ุงุญุชูุงู ุดุฑูู ุงูุดูุณ ูู ุงูุดุฑู ุบุฏุงูุ", options: ["ูุณุชุญูู", "ุฃููุฏ", "ุถุนูู", "ูููู"], correct: 1 },
          { q: "ูู ุฌุฏูู ุงูุฅุดุงุฑุงุชุ ุชูุซู ุงูุญุฒูุฉ (ๅ) ุงูุนุฏุฏ:", options: ["ูฃ", "ูค", "ูฅ", "ูฆ"], correct: 2 }
        ],
        ูุชูุณุท: [
          { q: "ุชูุซูู ููุถุญ ุฃู ูฆ ุทูุงุจ ููุถููู ุงูุฑุณู ู ูฃ ููุถููู ุงููุฑุงุกุฉ. ูู ูุฒูุฏ ุนุฏุฏ ูุญุจู ุงูุฑุณูุ", options: ["ูข", "ูฃ", "ูค", "ูฉ"], correct: 1 },
          { q: "ูู ููุณ ูฅ ูุฑุงุช ุญูุฑุงุก ููุฑุชุงู ุฒุฑูุงุก. ุณุญุจูุง ูุฑุฉุ ุงูุงุญุชูุงู 'ุงูุฃูุซุฑ' ูู ุงูููู:", options: ["ุงูุฃุญูุฑ", "ุงูุฃุฒุฑู", "ุงูุฃุตูุฑ", "ุงูุฃุจูุถ"], correct: 0 },
          { q: "ุฅุฐุง ุฏูุฑุช ูุคุดุฑ ูุฑุต ูุตูู ุฃุญูุฑ ููุตูู ุฃุฒุฑูุ ูุฅู ุงุญุชูุงู ุงููููู ุนูู ุงูุฃุญูุฑ ูู:", options: ["ุฃููุฏ", "ูุณุชุญูู", "ูุชุณุงูู ุงูุฅููุงููุฉ", "ุถุนูู"], correct: 2 },
          { q: "ุชู ุณุคุงู ูกู ุทูุงุจ ุนู ูุงููุชูู ุงูููุถูุฉุ ูง ุงุฎุชุงุฑูุง ุงูููุฒ. ูู ุทุงูุจุงู ูู ูุฎุชุงุฑูุง ุงูููุฒุ", options: ["ูก", "ูข", "ูฃ", "ูค"], correct: 2 },
          { q: "ุงูุชูุซูู ุจุงูุฃุนูุฏุฉ ูุณุชุฎุฏู ... ูุนุฑุถ ุงูุจูุงูุงุช.", options: ["ุงูุตูุฑ", "ุงูุฅุดุงุฑุงุช", "ุงูุฃุนูุฏุฉ", "ุงูููุงุท"], correct: 2 }
        ],
        ูุชูุฏู: [
          { q: "ุนูุฏ ุชุฏููุฑ ูุคุดุฑ ูุฑุต ููุณู ูู ูค ุฃููุงู ูุชุณุงููุฉุ ุงุญุชูุงู ููููู ุนูู ููู ูุงุญุฏ ูู:", options: ["ูุคูุฏ", "ูุณุชุญูู", "ุชุณุงูู ุงููุฑุต", "ุฃูุซุฑ ุงุญุชูุงูุงู"], correct: 2 },
          { q: "ุฅุฐุง ูุงู ููุงู ูค ูุฑุงุช ุฎุถุฑุงุก ููุฑุฉ ูุงุญุฏุฉ ุตูุฑุงุกุ ููุง ุงุญุชูุงู ุณุญุจ ูุฑุฉ ุฎุถุฑุงุกุ", options: ["ุฃูู ุงุญุชูุงูุงู", "ุฃูุซุฑ ุงุญุชูุงูุงู", "ูุณุชุญูู", "ูุคูุฏ"], correct: 1 },
          { q: "ุชูุซูู ุจุงูููุงุท ูุธูุฑ ูฅ ุฅุดุงุฑุงุช ููู ุงูุฑูู ูกูุ ูุฐุง ูุนูู ุฃู ุงูุฑูู ูกู ุชูุฑุฑ:", options: ["ูุฑุชูู", "ูฃ ูุฑุงุช", "ูฅ ูุฑุงุช", "ูกู ูุฑุงุช"], correct: 2 },
          { q: "ุฃู ุงูุฃุดูุงู ุงูุชุงููุฉ ูุณุชุฎุฏู ูุชูุซูู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุงูุตูุฑุ", options: ["ุงูุฃุนูุฏุฉ", "ุงูุตูุฑ", "ุงูุฅุดุงุฑุงุช", "ุงูุฏูุงุฆุฑ"], correct: 1 },
          { q: "ุนูุฏ ุฑูู ูุทุนุฉ ููุฏูุฉุ ูุง ูู ุงุญุชูุงู ุธููุฑ 'ุงูุดุนุงุฑ'ุ", options: ["ูุคูุฏ", "ูุณุชุญูู", "ูุชุณุงูู ุงูุฅููุงููุฉ", "ุถุนูู"], correct: 2 }
        ]
      }
    };

    const domainNames = { numbers: "ุงูุฃุนุฏุงุฏ", algebra: "ุงูุฌุจุฑ", geometry: "ุงูููุฏุณุฉ", stats: "ุงูุฅุญุตุงุก" };
    let currentStudent = null, allStudents = [], currentQuiz = null, userAnswers = {}, teacherClicks = 0;

    function init() {
      let v = parseInt(localStorage.getItem('visitCount') || '0') + 1;
      localStorage.setItem('visitCount', v);
      document.getElementById('visitCount').textContent = v;

      database.ref('students').on('value', (snapshot) => {
        allStudents = snapshot.val() ? Object.values(snapshot.val()) : [];
        updateLeaderboard();
        updateStats();
      });

      document.getElementById('starsBox').addEventListener('click', () => {
        teacherClicks++;
        if(teacherClicks === 3) {
          document.getElementById('adminResetBtn').classList.toggle('hidden');
          alert('ุชู ุชูุนูู ูุถุน ุงููุนููุฉ ๐๏ธ');
          teacherClicks = 0;
        }
      });
    }

    function updateStats() {
      const ts = allStudents.reduce((sum, s) => sum + (s.total_score || 0), 0);
      document.getElementById('totalStars').textContent = ts;
      if (allStudents.length > 0) {
        const sorted = [...allStudents].sort((a,b) => b.total_score - a.total_score);
        document.getElementById('lastVisitor').textContent = sorted[0].student_name;
      }
    }

    function updateLeaderboard() {
      const container = document.getElementById('allStudentsRanking');
      const sorted = [...allStudents].sort((a,b) => b.total_score - a.total_score);
      if (sorted.length === 0) { container.innerHTML = '<p class="text-center text-gray-400 text-xs italic">ูุง ุชูุฌุฏ ูุชุงุฆุฌุ ูู ุงูุฃูู!</p>'; return; }
      container.innerHTML = sorted.slice(0, 5).map((s, i) => `
        <div class="ranking-item slide-in">
          <span class="w-7 h-7 flex items-center justify-center bg-purple-100 rounded-full text-purple-700 font-black ml-3 text-xs">${i + 1}</span>
          <div class="flex-1 text-sm font-bold text-gray-700">${s.student_name}</div>
          <div class="text-emerald-600 font-bold text-sm">${s.total_score} โญ</div>
        </div>
      `).join('');
    }

    document.getElementById('btnStartQuiz').addEventListener('click', () => {
      const name = document.getElementById('studentNameInput').value.trim();
      if (name.length < 4) return alert('ุจุทููุง.. ุงูุชุจ ุงุณูู ุงูุซูุงุซู!');
      currentStudent = name;
      document.getElementById('loginBox').classList.add('hidden');
      document.getElementById('quizSelection').classList.remove('hidden');
    });

    document.querySelectorAll('.quizBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentQuiz = { domain: btn.dataset.domain, level: btn.dataset.level };
        userAnswers = {};
        document.getElementById('homeScreen').classList.add('hidden');
        document.getElementById('quizScreen').classList.remove('hidden');
        document.getElementById('quizTitle').textContent = `${domainNames[currentQuiz.domain]} - ูุณุชูู ${currentQuiz.level}`;
        const qData = questions[currentQuiz.domain][currentQuiz.level];
        document.getElementById('questionsContainer').innerHTML = qData.map((q, i) => `
          <div class="bg-white p-6 rounded-3xl shadow-sm border border-purple-50">
            <p class="font-black text-purple-900 mb-5 leading-relaxed text-md">${i+1}. ${q.q}</p>
            <div class="space-y-3">
              ${q.options.map((opt, oi) => `
                <label class="flex items-center p-4 rounded-2xl border-2 border-gray-100 option-hover cursor-pointer transition-all">
                  <input type="radio" name="q${i}" value="${oi}" class="w-5 h-5 accent-emerald-600" onchange="userAnswers[${i}]=${oi}">
                  <span class="mr-3 font-bold text-gray-700 text-sm">${opt}</span>
                </label>
              `).join('')}
            </div>
          </div>
        `).join('');
      });
    });

    document.getElementById('btnSubmitQuiz').addEventListener('click', async () => {
      const qData = questions[currentQuiz.domain][currentQuiz.level];
      if (Object.keys(userAnswers).length < qData.length) return alert('ุฃููู ุงูุญู ูุง ุจุทู!');
      let score = 0; qData.forEach((q, i) => { if (userAnswers[i] === q.correct) score++; });
      let existing = allStudents.find(s => s.student_name === currentStudent);
      let newScore = (existing ? existing.total_score : 0) + score;
      const safeName = currentStudent.replace(/[.#$[\]]/g, "_");
      await database.ref('students/' + safeName).set({ student_name: currentStudent, total_score: newScore });
      document.getElementById('quizScreen').classList.add('hidden');
      document.getElementById('resultsScreen').classList.remove('hidden');
      document.getElementById('resultName').textContent = currentStudent;
      document.getElementById('scoreDisplay').textContent = `${score} / ${qData.length}`;
      document.getElementById('starsDisplay').innerHTML = 'โญ'.repeat(score || 1);
    });

    document.getElementById('btnBackHome').addEventListener('click', () => location.reload());
    document.getElementById('btnTakeAnother').addEventListener('click', () => {
      document.getElementById('resultsScreen').classList.add('hidden');
      document.getElementById('homeScreen').classList.remove('hidden');
      document.getElementById('quizSelection').classList.remove('hidden');
    });

    function clearSystemData() {
      if (prompt("ูููุฉ ูุฑูุฑ ุงูุฅุฏุงุฑุฉ:") === "1234") {
        if(confirm('ุณูุชู ุญุฐู ูุงูุฉ ุงููุชุงุฆุฌุ ูู ุฃูุชู ูุชุฃูุฏุฉุ')) {
          database.ref('students').remove().then(() => location.reload());
        }
      } else { alert("ุฑูุฒ ุฎุงุทุฆ!"); }
    }
    init();
  </script>
 </body>
</html>